var PSKweb;PSKweb.Tools=PSKweb.Tools||{};PSKweb.Tools.BlockFullScreen=function(){var i={spinnerOptions:{lines:11,length:30,width:20,radius:40,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"48.7%"}},r=i,u=function(n){$.extend(!0,i,n);r=i},n=null,t=!1,f=function(){if(n||(n=new Spinner(r.spinnerOptions)),!t){var i=$("#fixedDivForSpinner");i.length||(i=$("<div>").attr("id","fixedDivForSpinner").css({position:"fixed",left:"50%",top:"50%","z-index":"2000"}).appendTo("body"));n.spin(i[0]);$.blockUI({baseZ:2e3,message:"",overlayCSS:{cursor:"default"}});t=!0}},e=function(){t&&(n.stop(),$.unblockUI(),t=!1)};return{block:f,unblock:e,setDefaults:u}}();PSKweb.Tools=PSKweb.Tools||{};PSKweb.Tools.Submit=function(){var n={scrollTopOnMessageShow:!1},t=n,i=function(i){$.extend(!0,n,i);t=n},r=function(n,t,i){$("body").append('<form action="'+t+'" method="post" target="'+i+'" id="postToIframe"><\/form>');$.each(n,function(n,t){$("#postToIframe").append('<input type="hidden" name="'+n+'" value="'+t+'" />')});$("#postToIframe").submit().remove()},u=function(n,i){var u;if(!n.data("submitPending")){var f=function(){PSKweb.Tools.BlockFullScreen.block();n.data("submitPending",!0)},e=function(){n.data("submitPending",!1);n.closest(".modal").data("reload-on-close",!0);PSKweb.Tools.BlockFullScreen.unblock()},o=function(t){t&&t.redirectTo&&(i&&i.length>0?(n.hide(),t.postParams?r(t.postParams,t.redirectTo,i.attr("name")):i.prop("src",t.redirectTo),i.show()):window.location=t.redirectTo)};f();var s=!0,h=validationTools.summary(n.find("[data-validation-summary=message]"),t.scrollTopOnMessageShow),c=n.find(":not([data-protected=true])").serialize();return $.ajax({url:n.attr("action"),cache:!1,type:n.attr("method"),data:c,success:function(t){t.registration&&(t.success?PSKweb.GTM.Registration.success():PSKweb.GTM.Registration.failure());t.redirectTo?t.redirectPending?(s=!1,f(),setTimeout(function(){o(t);e()},t.redirectPending)):o(t):h.displayServerValidation(n,t)},error:function(n){if(n.registration&&PSKweb.GTM.Registration.failure(),window.isDebug){var t=window.open("","","width=400,height=400,resizeable,scrollbars");t.document.write(n.responseText);t.document.close()}else h.showGeneralErrorMessage()},complete:function(){s&&e()}})}return u=$.Deferred(),u.reject("submitPending"),u.promise()};return{setDefaults:i,withIFrameAndPending:u}}();$("input[type=checkbox]").next().filter("input[type=hidden]").remove();PSKweb=PSKweb||{};PSKweb.Registration=function(){var t=function(){PSKweb.Tools.Submit.setDefaults({scrollTopOnMessageShow:!0});$("#SubmitFormDoRegistration").on("click",function(){var t=$("#FormDoRegistration");t.valid()?(PSKweb.Tools.Submit.withIFrameAndPending(t).done(function(i){i.redirectTo||n(t,i||!0)}),localStorage.setItem("SessionStartTime",new Date)):n(t)})},n=function(n,t){var i,r,u;try{i={};r=n.validate().errorMap;_.each(n.serializeArray(),function(n){n.name.toLowerCase().indexOf("password")===-1&&(i[n.name]={val:n.value,error:r[n.name]})});for(u in r)r.hasOwnProperty(u)&&(i[u]||(i[u]={error:r[u]}));i.fromServer=!!t;i.serverData=t;$.post(PSKweb.Utils.baseUrl+"Errors/LogRegistrationError",{data:JSON.stringify(i)})}catch(f){console.log(f)}};return{init:t}}();PSKweb.Loading.addLoadingFunction(function(){PSKweb.Registration.init();PSKweb.ViewJmbgDisplay.init()},"Account/Registration.js");PSKweb.ViewJmbgDisplay=function(){var n=function(){var n=$("[data-check-jmbg-for-country-id]");n.data("disable-jmbg-input-for-other-countries")&&n.on("change load-on-init",function(){var n=$(this),r=n.data("check-jmbg-for-country-id"),u=n.find("option:selected").val(),f=n.data("jmbg-selector"),e=n.data("jmbg-section-selector"),t=$(f),i=$(e);r==u?(t.show(),t.prop("disabled",!1),i.show()):(t.hide(),t.prop("disabled",!0),i.hide())}).trigger("load-on-init")};return{init:n}}();jQuery.validator.unobtrusive.adapters.add("oibcheck",function(n){validationTools.setValidationValues(n,"oibcheck",!0)});jQuery.validator.addMethod("oibcheck",function(n){return n.length!=11?!1:validationTools.checkIso7064_11_10ControlDigit(n)});jQuery.validator.unobtrusive.adapters.add("jmbgcheck",["countryid","countryidforjmbgcheck"],function(n){validationTools.setValidationValues(n,"jmbgcheck",!0)});jQuery.validator.addMethod("jmbgcheck",function(n,t,i){function f(n,t){for(var i=0,u=n.length-1,r=2;u>=0;u--)i+=parseInt(n.charAt(u),10)*r,r=r===7?2:r+1;return i=11-i%11,typeof t=="undefined"?i:t(i)}var r=$("#"+validationTools.getViewModelPrefix(t.name)+i.countryid),u;return(validationTools.addDependentField(t.id,r[0].id),r.val()!=i.countryidforjmbgcheck)?!0:(u=function(n){return n.length===13&&!isNaN(n)?/^60|66$/.test(n.substring(7,9))||parseInt(n.charAt(12),10)===f(n.substring(0,12),function(n){return n===11?0:n===10?"X":n}):!1},u(n))});jQuery.validator.unobtrusive.adapters.add("cnpcheck",["countryid","countryidforjmbgcheck"],function(n){validationTools.setValidationValues(n,"cnpcheck",!0)});jQuery.validator.addMethod("cnpcheck",function(n,t,i){var f=$("#"+validationTools.getViewModelPrefix(t.name)+i.countryid),e,r;if(validationTools.addDependentField(t.id,f[0].id),f.val()!=i.countryidforjmbgcheck)return!0;if(e=/^\d{1}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])(0[1-9]|[1-4]\d|5[0-2]|99)\d{4}$/,e.test(n)){var o=0,u=0;for(r=0;r<12;r++)o+=n[r]*"279146358279"[r];return u=o%11,u==10&&(u=1),u==n[12]}return!1});PSKweb=PSKweb||{};PSKweb.Account={generateIbanModal:function(){$("#FakeFormForValidation").valid()&&(this.generateIban(),$("#iban-helper").modal("hide"))},generateIban:function(){var n=$("[data-iban-helper=bank-account-prefix]"),t=$("[data-iban-helper=bank-account-number]"),r=$("[data-iban-helper=iban-country-code]"),i;n.valid()&&t.valid()&&(i=PSKweb.Account.parseIban(n.val(),t.val(),r.val()),$("[data-iban-helper=set-iban]").val(i.substring(2)).valid())},initGenerateIbanInline:function(){var n=this;$(document).on("change blur","[data-iban-helper=bank-account-prefix], [data-iban-helper=bank-account-number]",function(){n.generateIban()})},runningMod:function(n,t){for(var i="",u,r=0;r<n.length;r++)i+=n.charAt(r),u=i%t,i=u.toString(10);return i/1},parseIban:function(n,t,i){var u=n+t+i+"00",r;return u=u.toUpperCase().split("").map(function(n){var t=n.charCodeAt(0);return t>="A".charCodeAt(0)&&t<="Z".charCodeAt(0)?t-"A".charCodeAt(0)+10:n}).join(""),r=98-PSKweb.Account.runningMod(u,97),r<10&&(r="0"+r),i+r+n+t}};PSKweb.Loading.addLoadingFunction(function(){PSKweb.ViewJmbgDisplay.init()},"js/account.js");jQuery.validator.unobtrusive.adapters.add("bankaccount",["prefixid","bankprefixlength","accountnumberlength","controldigittype","controldigitcheckwithoutbankprefix"],function(n){validationTools.setValidationValues(n,"bankaccount",!0)});jQuery.validator.addMethod("bankaccount",function(n,t,i){var e=$("#"+validationTools.getViewModelPrefix(t.name)+i.prefixid),f=e.val(),r=$(t).val(),o=f.toString().length===parseInt(i.bankprefixlength)&&r.toString().length===parseInt(i.accountnumberlength),u;if(o)if(i.controldigittype){u=parseInt(i.controldigitcheckwithoutbankprefix)===1?r:f+r;switch(i.controldigittype){case"Iso7064_11_10":return validationTools.checkIso7064_11_10ControlDigit(u);case"Iso7064_97_10":return validationTools.checkIso7064_97_10ControlDigit(u);default:return!0}}else return!0;return!1});$.validator.unobtrusive.adapters.add("iban",["countrycodeid"],function(n){validationTools.setValidationValues(n,"iban",!0)});$.validator.addMethod("iban",function(n,t,i){if(this.optional(t))return!0;var r=n.replace(/ /g,"").toUpperCase(),e="",l=!0,o="",a="",v,s,h,y,c,p,w,u,f,k=i.countrycodeid,b=$("#"+validationTools.getViewModelPrefix(t.name)+k).val();if((r.substring(0,2)!==b&&(r=b+r),!/^([a-zA-Z0-9]{4} ){2,8}[a-zA-Z0-9]{1,4}|[a-zA-Z0-9]{12,34}$/.test(r))||(v=r.substring(0,2),p={AL:"\\d{8}[\\dA-Z]{16}",AD:"\\d{8}[\\dA-Z]{12}",AT:"\\d{16}",AZ:"[\\dA-Z]{4}\\d{20}",BE:"\\d{12}",BH:"[A-Z]{4}[\\dA-Z]{14}",BA:"\\d{16}",BR:"\\d{23}[A-Z][\\dA-Z]",BG:"[A-Z]{4}\\d{6}[\\dA-Z]{8}",CR:"\\d{17}",HR:"\\d{17}",CY:"\\d{8}[\\dA-Z]{16}",CZ:"\\d{20}",DK:"\\d{14}",DO:"[A-Z]{4}\\d{20}",EE:"\\d{16}",FO:"\\d{14}",FI:"\\d{14}",FR:"\\d{10}[\\dA-Z]{11}\\d{2}",GE:"[\\dA-Z]{2}\\d{16}",DE:"\\d{18}",GI:"[A-Z]{4}[\\dA-Z]{15}",GR:"\\d{7}[\\dA-Z]{16}",GL:"\\d{14}",GT:"[\\dA-Z]{4}[\\dA-Z]{20}",HU:"\\d{24}",IS:"\\d{22}",IE:"[\\dA-Z]{4}\\d{14}",IL:"\\d{19}",IT:"[A-Z]\\d{10}[\\dA-Z]{12}",KZ:"\\d{3}[\\dA-Z]{13}",KW:"[A-Z]{4}[\\dA-Z]{22}",LV:"[A-Z]{4}[\\dA-Z]{13}",LB:"\\d{4}[\\dA-Z]{20}",LI:"\\d{5}[\\dA-Z]{12}",LT:"\\d{16}",LU:"\\d{3}[\\dA-Z]{13}",MK:"\\d{3}[\\dA-Z]{10}\\d{2}",MT:"[A-Z]{4}\\d{5}[\\dA-Z]{18}",MR:"\\d{23}",MU:"[A-Z]{4}\\d{19}[A-Z]{3}",MC:"\\d{10}[\\dA-Z]{11}\\d{2}",MD:"[\\dA-Z]{2}\\d{18}",ME:"\\d{18}",NL:"[A-Z]{4}\\d{10}",NO:"\\d{11}",PK:"[\\dA-Z]{4}\\d{16}",PS:"[\\dA-Z]{4}\\d{21}",PL:"\\d{24}",PT:"\\d{21}",RO:"[A-Z]{4}[\\dA-Z]{16}",SM:"[A-Z]\\d{10}[\\dA-Z]{12}",SA:"\\d{2}[\\dA-Z]{18}",RS:"\\d{18}",SK:"\\d{20}",SI:"\\d{15}",ES:"\\d{20}",SE:"\\d{20}",CH:"\\d{5}[\\dA-Z]{12}",TN:"\\d{20}",TR:"\\d{5}[\\dA-Z]{17}",AE:"\\d{3}\\d{16}",GB:"[A-Z]{4}\\d{14}",VG:"[\\dA-Z]{4}\\d{16}"},c=p[v],typeof c!="undefined"&&(w=new RegExp("^[A-Z]{2}\\d{2}"+c+"$",""),!w.test(r))))return!1;for(s=r.substring(4,r.length)+r.substring(0,4),u=0;u<s.length;u++)h=s.charAt(u),h!=="0"&&(l=!1),l||(e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(h));for(f=0;f<e.length;f++)y=e.charAt(f),a=""+o+""+y,o=a%97;return o===1},"Please specify a valid IBAN")