var PSKweb=PSKweb||{};PSKweb.OfferSearch=function(){var n=".search-result",t=function(){var n=$(this),t=n.data("event-id").toString().replace("-",""),i=n.data("is-live");window.location=(i?"/Live#live/":"/Sports/Event?id=")+t},i=function(n,i){var r=JST["templates/OfferSearchResult.hbs"],u=JST["templates/MoreResults.hbs"];return $.ajax({type:"POST",url:"/OfferSearch/EventSearch",data:{query:n},cache:!1}).done(function(n){i.empty();var f=0;n&&n.length||i.html("&nbsp;&nbsp;"+PSKweb.Translations.noSearchResults);_.each(n,function(n){f=n.TotalResultCount;n.StartDateTime=new Date(n.StartDateTime);var t=new Date(n.StartDateTime).setHours(0,0,0,0),u=Math.floor(Math.abs((new Date).setHours(0,0,0,0)-t)/864e5);n.Date=u<7?PSKweb.Core.capitalizeFirstLetter(PSKweb.TimeHelper.formatDateInPlayerTimezone(n.StartDateTime,{raw:"EEEE"})):PSKweb.TimeHelper.formatDateInPlayerTimezone(n.StartDateTime,{skeleton:"Md"});n.Time=PSKweb.TimeHelper.formatDateInPlayerTimezone(n.StartDateTime,{time:"short"});i.append(r(n))});f>n.length&&i.append(u({msg:PSKweb.Translations.tooManySearchResults.formatWith(n.length,f)}));i.find("li:first").addClass("current");i.find("li").mousedown(t);i.addClass("active")}).fail(function(){i.text(PSKweb.Translations.searchError);i.addClass("active")}),!1},r=function(){return $(".search ul.search-result")},u=function(n){clearTimeout($(n).data("timer"));var u=r(),t=$.trim($(n).val());t.length>2?$(n).data("timer",setTimeout(function(){i(t,u)},500)):$(".search-result").removeClass("active")},f=function(t){function r(n){var t=i[n]();t&&t.length&&(i.removeClass("current"),t.addClass("current"))}var i=$(".search ul.search-result li.current:first");switch(t){case 13:i.trigger("mousedown");break;case 27:$(n).removeClass("active");break;case 38:r("prev");break;case 40:r("next")}},e=function(){var t="#homepage-search, #sports-search";$(t).on("keydown",function(n){var t=n.which||n.keycode;if(t===13||t===27||t===38||t===40)return f(t),n.preventDefault(),!1});$(t).on("keyup focus",function(t){var i=t.keyCode||t.which;i===13||i===27||i===38||i===40||(i!==0?u(this):$(n).html().trim().length>0&&$.trim($(this).val()).length>2&&$(n).addClass("active"))});$(t).on("blur",function(){$(n).removeClass("active")})};return{init:e}}()