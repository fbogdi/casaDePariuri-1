window.PSK={LIVE:!0,isInitialized:!1,LiveHubUrl:null,LiveVideoStreamEnabled:!1,Models:{},Collections:{},Views:{},Routers:{},Utils:{},Bus:{},Controller:{},init:function(){"use strict";window.PSK.Routers=new PSK.Routers.Main;Backbone.history.start({pushState:!1});window.PSK.isInitialized=!0},initBox:function(){this.LIVE=!1;this.LiveBox=!0;this.LiveBoxMinimum=10;Backbone.history.start({pushState:!1});window.PSK.isInitialized=!0}};PSK.Controller.Hub=PSK.Controller.Hub||{},function(){var n=this;PSK.Controller.Hub=function(n){var t=this,i;PSKweb.initHub().done(function(){PSKweb.neutralHub.registerListener(t)});this.collection=n.collection;this.sports=n.sports;this.unselectedSports=n.unselectedSports;this.favoritesSports=n.favoritesSports;i=jQuery("<div>").addClass(".connecting-label").html("... connecting to service ...");jQuery(".content-container").prepend(i);this.onInitialState=function(n,r){PSK.Widget&&t.collection.reset(n);PSK.LIVE&&(t.sports.reset(r.Sports),t.unselectedSports.reset(r.Sports),t.favoritesSports.reset(r.Sports),t.collection.reset(n));PSK.LiveBox&&(t.sports.reset(r.Sports),t.collection.reset(n));i.remove();PSK.LIVE;PSK.Bus&&PSK.Bus.liveEvent&&PSK.Bus.liveEvent.trigger("liveEventsLoaded");t.isInitialized=!0};this.onChange=function(n){t.isInitialized&&(PSK.LIVE||PSK.Widget||PSK.LiveBox)&&t.collection.update(n);i.remove()};this.onAliveMessage=function(n,r){(PSK.LIVE||PSK.Widget||PSK.LiveBox)&&t.collection.removeDeadEvents(r);i.remove()};this.onBetStart=function(n){(PSK.LIVE||PSK.LiveBox)&&t.collection.betStart(n)};this.onBetStop=function(n){(PSK.LIVE||PSK.LiveBox)&&t.collection.betStop(n)}};_.extend(PSK.Controller.Hub.prototype,Backbone.Events)}();Backbone.View.prototype.close=function(){this.remove();this.unbind();this.stopListening();this.childViews&&this.childViews.each(function(n){n.close()})};PSK.Utils=PSK.Utils||{},function(){"use strict";var n=1,t=2,i=3;PSK.Utils={switchView:function(n){var t=this.currentView,i;t&&t.cleanup&&t.cleanup();i=n.render();$("#psk-main-layout, #live-offer-box").html(i.el);i.trigger("ready");this.currentView=n},replaceCroatianChars:function(n){n=n||"";return n.replace(/č/g,"c").replace(/Č/g,"C").replace(/Č/g,"C").replace(/ć/g,"c").replace(/Ć/g,"C").replace(/š/g,"s").replace(/Š/g,"S").replace(/Đ/g,"D").replace(/đ/g,"d").replace(/Š/g,"S").replace(/š/g,"s")},trimSpaces:function(n){return(n||"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},padString:function(r,u,f,e){if(typeof u=="undefined"&&(u=0),typeof f=="undefined"&&(f=" "),typeof e=="undefined"&&(e=t),u+1>=r.length)switch(e){case n:r=new Array(u+1-r.length).join(f)+r;break;case i:var o=u-r.length,s=Math.ceil(o/2),h=o-s;r=new Array(h+1).join(f)+r+new Array(s+1).join(f);break;default:r=r+new Array(u+1-r.length).join(f)}return r},fixContentContainerSize:function(){},teamSetScore:function(n,t){if(t=t||1,n){var u=n.split("-"),i="",r="",f=u.length>1?"0":"&nbsp&nbsp";return($(u).each(function(n,t){var o=t.split(":"),u=PSK.Utils.trimSpaces(o[0]),e=PSK.Utils.trimSpaces(o[1]);u.length<e.length?u=f+u:e.length<u.length&&(e=f+e);i+='<span class="score-spacer">'+u+"<\/span>";r+='<span class="score-spacer">'+e+"<\/span>"}),i=PSK.Utils.trimSpaces(i),r=PSK.Utils.trimSpaces(r),t===1)?i:r}return'<span class="score-spacer">-<\/span>'},checkIE11:function(){return!!navigator.userAgent.match(/(Trident).*(rv:11)/)},renderCards:function(n,t,i){var f=n.get("Cards"),r,u;f&&(r=n.get("Cards").filter(function(n){return n.Team=="home"}),u=n.get("Cards").filter(function(n){return n.Team=="guest"||n.Team=="away"}),r&&r.length>0&&(r=r.sort(function(n,t){return n.Time<t.Time?1:n.Time>t.Time?-1:0}),PSK.Utils.renderTeamCards(n,r,t)),u&&u.length>0&&(u=u.sort(function(n,t){return n.Time<t.Time?-1:n.Time>t.Time?1:0}),PSK.Utils.renderTeamCards(n,u,i)))},renderTeamCards:function(n,t,i){var r=document.createDocumentFragment();$(t).each(function(n,t){var i=document.createElement("span");i.className="event-header-card "+t.Type;t.Time>=0;i.setAttribute("data-container","body");r.appendChild(i)});$(i).find(".event-header-cards span").tooltip("destroy");$(i).html(r);$(i).children("span").tooltip({html:!0,title:_.compose(this._renderCompleteCards,this._wrapper.bind(n))})},_wrapper:function(){return this},_renderCompleteCards:function(n){var r=n.get("Cards").filter(function(n){return n.Team=="home"}),u=n.get("Cards").filter(function(n){return n.Team=="guest"||n.Team=="away"}),e=$("<div><\/div>"),o=$("<table><\/table>").addClass("complete-cards").html('<tr><th class="home">'+n.get("Team1Name")+'<\/th><th colspan="2" class="guest">'+n.get("Team2Name")+"<\/th><\/tr>"),f,i,t;for(e.append(o),t=0;t<Math.max(r.length,u.length);t++)f=$("<tr><\/tr>"),i=$("<td><\/td>").addClass("home"),t<r.length&&r[t].Time>0&&(i.append($("<span><\/span>").text(r[t].Time+"'")),i.append($("<span><\/span>").text(r[t].Player)),i.addClass(r[t].Type)),f.append(i),i=$("<td><\/td>").addClass("guest"),t<u.length&&u[t].Time>0&&(i.append($("<span><\/span>").text(u[t].Time+"'")),i.append($("<span><\/span>").text(u[t].Player)),i.addClass(u[t].Type)),f.append(i),o.append(f);return e.html()}}}();Handlebars.registerHelper("shortNameUpper",function(n){return length=length||16,n.substring(0,length-1)});Handlebars.registerHelper("teamScore",function(n){"use strict";return n?n.replace(":"," - "):""});Handlebars.registerHelper("teamSetScore",function(n,t){return PSK.Utils.teamSetScore(n,t)});Handlebars.registerHelper("SumScore",function(n){return n.length===0?"-":_.reduce(n,function(n,t){return n+ +t},0)});Handlebars.registerHelper("Math",function(n,t,i){return n=parseFloat(n),i=parseFloat(i),{"+":n+i,"-":n-i,"*":n*i,"/":n/i,"%":n%i}[t]});Handlebars.registerHelper("FormatPickOdds",function(){return""});Handlebars.registerHelper("teamSetScoreHtml",function(n,t){var i=PSK.Utils.teamSetScore(n,t);return'<span class="set-score-spacer-cell"><\/span><span class="set-score-cell">'+i.split(" ").join('<\/span><span class="set-score-cell">')+"<\/span>"});Handlebars.registerHelper("FormatPickOdds",function(n){return PSKweb.formatBetPickOdds(n)});Handlebars.registerHelper("sportLabel",function(n){"use strict";return PSKweb.Utils.getDefaultSportName(n)});Handlebars.registerHelper("Translations",function(n){return PSKweb.Translations[n]});Handlebars.registerHelper("Coalesce",function(){var n=_.without(arguments,_.last(arguments));return _.reduce(n,function(n,t){return n?n:t},null)});Handlebars.registerHelper("CascadeWidth",function(n,t){for(var i=2;i<arguments.length-1;i++)if(PSKweb.Core.measureString(n,arguments[i])<=t)return arguments[i];return arguments[arguments.length-2]});PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.AbstractList=Backbone.View.extend({className:"list",events:{all:"onEventTrigger"},initialize:function(n){this.items=[];this.listenTo(this.collection,"add",this.addItem,this);this.listenTo(this.collection,"reset",this.addAll,this);this.listenTo(this.collection,"remove",this.removeItem,this);this.itemViewData=n.itemViewData;this.showAnnouncements=n.showAnnouncements||!1},render:function(){return this.addAll(),this},addAll:function(){this.$el.html("");this.collection.each(function(n){this.addItem(n)},this)},addItem:function(n){var r=this.items.filter(function(t){return t.model==n}),i=this,t;jQuery(r).each(function(n,t){t.close();i.items.splice(i.items.indexOf(t),1)});t=this._createItemView(n);this.items.push(t);this.$el.append(t.render().el)},removeItem:function(n){var t=this.getViewByModel(n),i;t&&(t.cleanup&&t.cleanup(),t.remove(),i=this.items.indexOf(t),this.items.splice(i,1))},getViewByModel:function(n){return _.find(this.items,function(t){return t.model===n})},cleanup:function(){this.collection.off("reset",this.addAll,this);this.off()},_createItemView:function(n){var t={model:n},i;this.itemViewData&&(t.data=this.itemViewData);this.itemViewEl&&(t.el=this.itemViewEl);i=new this.singleItem(t);i.on("all",this.onEventTrigger,this);return i},onEventTrigger:function(n,t){this.trigger(n+":item",t)},removeAllItems:function(){this.collection.each(function(n){this.removeItem(n)},this)},remove:function(){Backbone.View.prototype.remove.call(this,arguments);this.removeAllItems()}})}();PSK.Models=PSK.Models||{},function(){"use strict";PSK.Models.BetOffer=Backbone.Model.extend({idAttribute:"BetOfferId",defaults:{SelectedBetPick:null,SelectedBetPickIndex:-1},initialize:function(){this.betEvent=this.collection.betEvent;this.listenTo(PSKweb.Betslip.Model,"bets:change bets:add bets:remove bets:reset",this.onBetslipChange);this.listenTo(PSKweb.Betslip.Model,"change:ActiveBetslipIndex",this.updateSelectedBet);this.onBetslipChange()},onBetslipChange:function(n){(n===undefined||n.get("EventId")===this.betEvent.get("Id"))&&this.updateSelectedBet()},updateSelectedBet:function(){var n=PSKweb.Betslip.Model.getActiveBetslip().bets.findWhere({BetOfferId:this.get("BetOfferId")});n!==undefined?this.set("SelectedBetPick",n.get("Pick")):this.set("SelectedBetPick",null)}})}();PSK.Models=PSK.Models||{},function(){"use strict";PSK.Models.Contest=Backbone.Model.extend({idAttribute:"ContestId",defaults:{ContestName:"Untitled",ContestOrder:0,NumOfEventsWithVideos:0},initialize:function(){this.events=new PSK.Collections.Event;this.listenTo(this.events,"add",this.onEventsAdd,this);this.listenTo(this.events,"reset",this.onEventsRemove,this);this.listenTo(this.events,"remove",this.onEventsReset,this)},onEventsAdd:function(n){n.hasVideoStream()&&this.set("NumOfEventsWithVideos",this.get("NumOfEventsWithVideos")+1);this.listenTo(n,"change:VideoStreamId",this.onEventVideoStreamIdChange)},onEventsRemove:function(n){n.hasVideoStream()&&this.set("NumOfEventsWithVideos",this.get("NumOfEventsWithVideos")-1);this.stopListening(n)},onContestsReset:function(){this.set("NumOfContestsWithVideos",this.events.reduce(function(n,t){return n+t.hasVideoStream()?1:0},0))},onEventVideoStreamIdChange:function(n){n.hasVideoStream()?this.set("NumOfEventsWithVideos",this.get("NumOfEventsWithVideos")+1):this.set("NumOfEventsWithVideos",this.get("NumOfEventsWithVideos")-1)}})}();PSK.Models=PSK.Models||{};PSK.Utils=PSK.Utils||{},function(){"use strict";PSK.Models.LiveEvent=Backbone.Model.extend({idAttribute:"Id",defaults:{Favorite:!1,Active:!0,IsReallyActive:!0,MatchTimeFormatted:"",StatusFormatted:"",Checked:!1},initialize:function(){this.on("change:BetOffers",this._onBetOffersChange,this);this.on("change:Favorite",this._onFavoriteChange,this);this.on("change:BettingAllowed change:Active",this._updateReallyActive,this);this.on("change:MatchTime",this._updateMatchTimeFormatted,this);this.on("change:Status",this._updateStatusFormatted,this);this._updateReallyActive();this._updateMatchTimeFormatted();this._updateStatusFormatted();this.on("change:StartTime",this._updateStartTime,this);this.betOffers=new PSK.Collections.BetOffer(this.get("BetOffers"),{betEvent:this})},hasVideoStream:function(){return PSKweb.LiveVideoStreamEnabled&&!!this.get("VideoStreamId")},_updateStartTime:function(){var t=parseInt(this.get("StartTime").split(":")[0],10),n;t=t<24?t>=0?t:0:23;this._previousAttributes.StartTime!=null&&(n=parseInt(this._previousAttributes.StartTime.split(":")[0],10),n=n<24?n>=0?n:0:23,t!=n&&PSK.Bus.liveEvent.trigger("changeHourGroup",this));PSK.Bus.liveEvent.trigger("change:StartTime",this)},_onBetOffersChange:function(){this.betOffers.update(this.get("BetOffers"));this._updateReallyActive()},_onFavoriteChange:function(){PSK.Bus.liveEvent.trigger("change:Favorite",this)},_updateReallyActive:function(){var n,t=this.getBetOffersEmptyReason();n=this.hasBetOffersEmpty()&&!t.isValid?!1:this.get("Active")&&this.get("BettingAllowed")&&!this.get("LiveDisabled");this.set("IsReallyActive",n)},getSportLabelKey:function(){return PSKweb.Utils.getDefaultSportName(this.get("SportId"))},parse:function(n){return n},getBetOffersEmptyReason:function(){var n={interrupted:PSKweb.Translations.liveBetOffersEmptyReasonInterrupted,walkover:PSKweb.Translations.liveBetOffersEmptyReasonRetired,retired:PSKweb.Translations.liveBetOffersEmptyReasonRetired,ended:PSKweb.Translations.liveBetOffersEmptyReasonEnded},i=function(t){var i;for(var r in n)t.indexOf(r)>-1&&(i=r);return i},r=function(t){return n.hasOwnProperty(t)?n[t]:PSKweb.Translations.liveBetOffersEmptyReasonDefault},u=this.get("Status")||"".toLowerCase(),t=i(u);return{isValid:typeof t!="undefined",translation:r(t)}},hasBetOffersEmpty:function(){return!this.has("BetOffers")||this.get("BetOffers").length==0},_updateMatchTimeFormatted:function(){var n,t=this.getSportLabelKey(),u=this.get("Status"),r={soccer:"paused",futsal:"paused",handball:"paused","ice-hockey":"paused",basketball:"pause2","american-football":"pause2"},f=r.hasOwnProperty(t)&&r[t]==u,i;f?n=t=="ice-hockey"?PSKweb.Translations.break_short:PSKweb.Translations.halftime_short:(i=this.get("MatchTime"),n=i?i+"'":"");this.set("MatchTimeFormatted",n)},_updateStatusFormatted:function(){var n,r=this.getSportLabelKey(),t=this.get("Status"),i=r=="ice-hockey"?{"1p":"1/3","2p":"2/3","3p":"3/3"}:{"1p":"1/2","2p":"2/2","1set":"1.S.","2set":"2.S.","3set":"3.S.","4set":"4.S.","5set":"5.S.","1q":"1/4","2q":"2/4","3q":"3/4","4q":"4/4","1IT":"1in","1IB":"1in","2IT":"2in","2IB":"2in","3IT":"3in","3IB":"3in","4IT":"4in","4IB":"4in","5IT":"5in","5IB":"5in","6IT":"6in","6IB":"6in","7IT":"7in","7IB":"7in","8IT":"8in","8IB":"8in","9IT":"9in","9IB":"9in",EIT:"ex. in",EIB:"ex. in"};n=i.hasOwnProperty(t)?i[t]:"";this.set("StatusFormatted",n)},isValidEvent:function(){return this.get("LiveDisabled")?!1:!this.get("IsReallyActive")&&this.hasBetOffersEmpty()&&["ended","not_started","retired","retired1","retired2"].indexOf(this.get("Status"))>-1?!1:!0}})}();PSK.Models=PSK.Models||{},function(){"use strict";PSK.Models.Sport=Backbone.Model.extend({idAttribute:"SportId",defaults:{SportName:"Untitled",BetTypes:[],NumOfContestsWithVideos:0},initialize:function(){this.events=new PSK.Collections.Event;this.contests=new PSK.Collections.Contest},onContestNumOfEventsWithVideosChange:function(n){n.get("NumOfEventsWithVideos")>0?this.set("NumOfContestsWithVideos",this.get("NumOfContestsWithVideos")+1):this.set("NumOfContestsWithVideos",this.get("NumOfContestsWithVideos")-1)},getSportLabelKey:function(){return PSKweb.Utils.getDefaultSportName(this.get("SportId"))},resetEvents:function(n){this.events.reset(n);this.contests.reset();_.each(this.events.groupBy("ContestId"),function(n){this._addNewContest(n)},this)},addEvent:function(n){var i=this.contests.findWhere({ContestId:n.get("ContestId")}),e,r,t,f,u,o;if(this.events.add(n),!i)for(i=this._createNewContest(n),this.contests.add(i),this.contests.sort(),e=jQuery(".psk-sport-group.sport-group-type-"+this.getSportLabelKey()+" .psk-contest-list"),o=function(n,t){return jQuery.map(n.children,function(n){return n.attributes["data-contest-id"].value}).filter(function(n){jQuery.inArray(n,jQuery.map(t.models,function(n){return n.id}))},this).length},t=0;t<e.length;t++)if(r=e[t],r.children.length==this.contests.length&&o(r,this.contests)==0)for(t=0;t<this.contests.length;t++)for(f=0;r.children[t].attributes["data-contest-id"].value!=this.contests.models[t].id;)if(jQuery(r).append(r.children[t]),f++>this.contests.length)break;if(i.events.add(n),u=jQuery('.psk-contest[data-contest-id="'+i.get("ContestId")+'"] .psk-event-list'),u.length==1&&u.children().length==i.events.length)for(t=0;t<i.events.length;t++)for(f=0;u.children()[t].attributes["data-event-id"].value!=i.events.models[t].id;)if(u.append(u.children()[t]),f++>i.events.length)break},removeEvent:function(n){this.events.remove(n);var t=this.contests.findWhere({ContestId:n.get("ContestId")});t&&(t.events.remove(n),t.events.length===0&&this.contests.remove(t))},_addNewContest:function(n){if(n&&n.length!==0){var t=this._createNewContest(n[0]);t.events.add(n);this.contests.add(t);t.get("NumOfEventsWithVideos")>0&&this.set("NumOfContestsWithVideos",this.get("NumOfContestsWithVideos")+1);this.listenTo(t,"change:NumOfEventsWithVideos",this.onContestNumOfEventsWithVideosChange)}},_removeContest:function(n){n.get("NumOfEventsWithVideos")>0&&this.set("NumOfContestsWithVideos",this.get("NumOfContestsWithVideos")-1);this.contests.remove(n);this.stopListening(n)},_createNewContest:function(n){return new PSK.Models.Contest({ContestId:n.get("ContestId"),ContestName:n.get("ContestName"),ContestOrder:n.get("ContestOrder")})}})}();PSK.Controller.AbstractEventGrouper=PSK.Controller.AbstractEventGrouper||{},function(){"use strict";PSK.Controller.AbstractEventGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.AbstractEventGrouper.prototype,Backbone.Events,{_init:function(n){this.collection=n.collection;this.sports=n.sports;this.listenTo(this.collection,"reset",this._onEventsReset,this);this.listenTo(this.collection,"add",this._onEventAdd,this);this.listenTo(this.collection,"remove",this._onEventRemove,this);this._onBeforeFirstAddEventsToSportGroups&&this._onBeforeFirstAddEventsToSportGroups();this._addEventsToSportGroups()},_addEventsToSportGroups:function(){var n=this.collection.groupBy(function(n){return n.get("SportId")}),t;this.sports.each(function(i){n[i.get("SportId")]?(t=new Backbone.Collection(n[i.get("SportId")]),i.resetEvents(t.where({IsAnnouncement:!1}))):i.resetEvents()})},_clearSportGroups:function(){this.sports.each(function(n){n.resetEvents()});this.favoriteBets&&this.unselectedBets&&(this.favoriteBets.reset(),this.unselectedBets.reset())},_onEventsReset:function(){this._clearSportGroups();this._addEventsToSportGroups()},_onEventAdd:function(n){n.get("SportId")&&(n.get("IsAnnouncement")||this.sports.get(n.get("SportId")).addEvent(n))},_onEventRemove:function(n){n.get("SportId")&&this.sports.get(n.get("SportId")).removeEvent(n)}})}();PSK.Controller.CalendarGrouper=PSK.Controller.CalendarGrouper||{},function(){"use strict";PSK.Controller.CalendarGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.CalendarGrouper.prototype,Backbone.Events,{_init:function(n){this.collection=n.collection;this.calGroups=n.calGroups;this.listenTo(this.collection,"reset",this._onEventsReset,this);this.listenTo(this.collection,"add",this._onEventAdd,this);this.listenTo(this.collection,"remove",this._onEventRemove,this);this._initCalGroups();this._addEventsToCalGroups(this.collection)},_initCalGroups:function(){for(var t,n=1;n<=7;n++)for(this.calGroups[n]={day:n},t=0;t<=23;t++)this.calGroups[n][t]=new PSK.Collections.CalendarGroup,this.calGroups[n][t].hour=t,this.calGroups[n][t].day=n},_addEventsToCalGroups:function(){this.collection.each(function(n){var t=this._getEventDayOfTheWeek(n),i=this._getEventHour(n);this.calGroups[t][i].add(n)},this)},_clearCalGroups:function(n){for(var i,t=1;t<=7;t++)for(i=0;i<=23;i++)this.calGroups[t][i].reset(n)},_onEventsReset:function(){this._clearCalGroups();this._addEventsToCalGroups()},_onEventAdd:function(n){var t=this._getEventDayOfTheWeek(n),i=this._getEventHour(n);this.calGroups[t][i].add(n)},_onEventRemove:function(n){var t=this._getEventDayOfTheWeek(n),i=this._getEventHour(n);this.calGroups[t][i].remove(n)},_getEventDayOfTheWeek:function(n){var t=parseInt(n.get("StartDay"),10);return t<7?t==0?7:t:7},_getEventHour:function(n){if(n.get("StartTime")){var t=parseInt(n.get("StartTime").split(":")[0],10);return t<24?t>=0?t:0:23}return 0}})}();PSK.Controller.EventGrouper=PSK.Controller.EventGrouper||{},function(){"use strict";PSK.Controller.EventGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.EventGrouper.prototype,PSK.Controller.AbstractEventGrouper.prototype,{_init:function(n){PSK.Controller.AbstractEventGrouper.prototype._init.apply(this,arguments);this.favoriteBets=n.favoriteBets;this.unselectedBets=n.unselectedBets;this.listenTo(this.collection,"change:IsAnnouncement",this._onAnnouncementChange,this)},_onAnnouncementChange:function(n){if(n.get("SportId")){var t=n.get("IsAnnouncement"),i=n.get("Favorite");t||(this.unselectedBets!=null&&(this.unselectedBets.remove(n),this.unselectedBets.add(n)),this.sports.get(n.get("SportId")).addEvent(n))}},_addEventsToSportGroups:function(){PSK.Controller.AbstractEventGrouper.prototype._addEventsToSportGroups.call(this);this.collection.each(function(n){n.get("IsAnnouncement")||(n.get("Favorite")?this.favoriteBets.add(n):this.unselectedBets.add(n))},this)},_onBeforeFirstAddEventsToSportGroups:function(){this.storedFavoriteEventIds=this._getFavoritesFromLocalStorage();this.storedMultiviewEventIds=this._getMultiviewFromLocalStorage();PSK.eventGrouper=this},_onEventsReset:function(){this.collection.map(function(n){this._checkIfEventShouldBeFavorited(n);this._checkIfEventShouldBeInMultiview(n)},this);PSK.Controller.AbstractEventGrouper.prototype._onEventsReset.call(this)},_onEventAdd:function(n){n.get("SportId")&&(this._checkIfEventShouldBeFavorited(n),this._checkIfEventShouldBeInMultiview(n),PSK.Controller.AbstractEventGrouper.prototype._onEventAdd.call(this,n),n.get("Favorite")?this.favoriteBets.add(n):this.unselectedBets.add(n))},_onEventRemove:function(n){n.get("SportId")&&(PSK.Controller.AbstractEventGrouper.prototype._onEventRemove.call(this,n),n.get("Favorite")?this.favoriteBets.remove(n):this.unselectedBets.remove(n))},_getFavoritesFromLocalStorage:function(){var n=JSON.parse(window.localStorage.getItem("favoriteEvents"));return _.isArray(n)?n:[]},_checkIfEventShouldBeFavorited:function(n){var t=this.storedFavoriteEventIds.indexOf(n.get("Id"));t>=0&&(n.set("Favorite",!0),this.storedFavoriteEventIds.splice(t,1))},_getMultiviewFromLocalStorage:function(){var n=JSON.parse(window.localStorage.getItem("multiviewEvents"));return _.isArray(n)?n:[]},_checkIfEventShouldBeInMultiview:function(n){var t=this.storedMultiviewEventIds.indexOf(n.get("Id"));t>=0&&(n.set("InMultiview",!0),this.storedMultiviewEventIds.splice(t,1))}})}();PSK.Controller.FavoritesGrouper=PSK.Controller.FavoritesGrouper||{},function(){"use strict";PSK.Controller.FavoritesGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.FavoritesGrouper.prototype,PSK.Controller.AbstractEventGrouper.prototype,{_init:function(){PSK.Controller.EventGrouper.prototype._init.apply(this,arguments);this.listenTo(PSK.Bus.liveEvent,"change:Favorite",function(n){n.get("Favorite")?this.collection.add(n):this.collection.remove(n);this._storeFavoritesToLocalStorage()},this)},_storeFavoritesToLocalStorage:function(){var n=this.collection.pluck("Id");return window.localStorage.setItem("favoriteEvents",JSON.stringify(n))}})}();PSK.Controller.LiveboxGrouper=PSK.Controller.LiveboxGrouper||{},function(){"use strict";PSK.Controller.LiveboxGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.LiveboxGrouper.prototype,PSK.Controller.AbstractEventGrouper.prototype,{_init:function(n){PSK.Controller.EventGrouper.prototype._init.apply(this,arguments);this.source=n.source;this.collection=n.collection;PSK.Bus.liveEvent.once("liveEventsLoaded",function(){var n=this.source.where({IsAnnouncement:!1,IsOnHomePage:!0,IsReallyActive:!0});n.length<PSK.LiveBoxMinimum&&(n=_.union(n,_.sample(this.source.where({IsAnnouncement:!1,IsOnHomePage:!1,IsReallyActive:!0}),PSK.LiveBoxMinimum-n.length)));this.collection.reset(n)},this);this.listenTo(this.source,"add change",function(n){var t=this;!n.get("IsAnnouncement")&&n.get("IsReallyActive")&&(n.get("IsOnHomePage")||t.collection.length<10)?(t.collection.add(n),t.collection.length>PSK.LiveBoxMinimum&&t.collection.remove(_.sample(t.collection.where({IsOnHomePage:!1})))):t.collection>10&&t.collection.remove(n)},this);this.listenTo(this.source,"change:IsReallyActive",function(n){n.get("IsReallyActive")||this.collection.remove(n)},this)}})}();PSK.Controller.UnselectedGrouper=PSK.Controller.UnselectedGrouper||{},function(){"use strict";PSK.Controller.UnselectedGrouper=function(){this._init.apply(this,arguments)};_.extend(PSK.Controller.UnselectedGrouper.prototype,PSK.Controller.AbstractEventGrouper.prototype,{_init:function(){PSK.Controller.EventGrouper.prototype._init.apply(this,arguments);this.listenTo(this.collection,"change:IsAnnouncement",function(n){n.get("IsAnnouncement")?this.collection.remove(n):(this.collection.remove(n),this.collection.add(n))},this);this.listenTo(PSK.Bus.liveEvent,"change:Favorite",function(n){n.get("Favorite")?this.collection.remove(n):this.collection.add(n)},this)}})}();PSK.Collections=PSK.Collections||{},function(){"use strict";PSK.Collections.Event=Backbone.Collection.extend({model:PSK.Models.LiveEvent,url:"mock/bet.json",parse:function(n){return n.data},update:function(n){for(var e=this,i,t,f=[],u,r=n.length-1;r>=0;r--)if(t=n[r],this.isValid(t))if(i=this.get(t[this.model.prototype.idAttribute]),i)u=$.extend(!0,{},i.toJSON()),PSKweb.Betslip.Model.overwriteProperties(u,t),i.set(u);else{if(t.ContestId==null){console.log("Primljena je poruka s novim događajem koji nema ContestId: "+t.Id);PSKweb!=null&&PSKweb.neutralHub!=null&&PSKweb.neutralHub.getEventDataById!=null&&PSKweb.neutralHub.getEventDataById(t.Id).done(function(n){n!=null&&(e.update([n]),console.log("Updateani su podaci za događaj "+n.Id))});continue}f.push(t)}this.add(f)},reset:function(n,t){t=t||{};t.silent||this.trigger("prereset",this,t);Backbone.Collection.prototype.reset.call(this,n!=null?n.filter(this.isValid):n,t)},isValid:function(n){var t=n.SportId||(n.get!==undefined?n.get("SportId"):null),i=n.Id||n.get("Id");return t==null?!0:PSK.eventGrouper!=null&&PSK.eventGrouper.sports.get(t)===undefined||PSK.liveboxController!=null&&PSK.liveboxController.sports.get(t)===undefined?(console.log("Input error: otkriven događaj (ID: "+i+") s neispravnim ID sporta - "+t),!1):!0},comparator:function(n,t){if(n.get("DisplayIndex")>t.get("DisplayIndex"))return 1;if(n.get("DisplayIndex")<t.get("DisplayIndex")||n.get("StartDate")==null||n.get("StartTime")==null)return-1;if(t.get("StartDate")==null||t.get("StartTime")==null)return 1;var i=(n.get("StartDate")+" "+n.get("StartTime")).match(/[0-9]+/g),r=(t.get("StartDate")+" "+t.get("StartTime")).match(/[0-9]+/g),u=new Date(i[2],i[1]-1,i[0],i[3],i[4]),f=new Date(r[2],r[1]-1,r[0],r[3],r[4]);return u>f?1:u<f?-1:n.get("Name")>t.get("Name")?1:n.get("Name")<t.get("Name")?-1:0},betStart:function(n){try{_.each(n,function(n){var t=this.get(n);t.hasBetOffersEmpty()==!1&&this.get(n).set("IsReallyActive",!0)},this)}catch(t){}},betStop:function(n){try{_.each(n,function(n){var t=this.get(n);t&&t.set("IsReallyActive",!1)},this)}catch(t){}},removeAliveEvents:function(n){var t=this.where({IsAnnouncement:!1}),i=_.pluck(_.map(t,function(n){return n.toJSON()}),"Id"),r=_.difference(i,n);_.each(r,function(n){this.remove(this.get(n))},this)},removeDeadEvents:function(n){_.each(n,function(n){this.remove(this.get(n))},this)},hasUnselectedEvents:function(n){var t=this.models.filter(function(n){return!n.get("IsAnnouncement")}),i=t.every(function(t){return n.indexOf(t)!==-1});return!i}})}();PSK.Collections=PSK.Collections||{},function(){"use strict";PSK.Collections.UnsortedEvent=PSK.Collections.Event.extend({comparator:function(){}})}();PSK.Collections=PSK.Collections||{},function(){"use strict";PSK.Collections.BetOffer=Backbone.Collection.extend({initialize:function(n,t){this.betEvent=t.betEvent},model:PSK.Models.BetOffer,update:function(n){for(var i,u,f=[],r,e,t=n.length-1;t>=0;t--)u=n[t],i=this.get(u[this.model.prototype.idAttribute]),i?i.set(u):f.push(u);for(e=jQuery.map(n,function(n){return n.BetOfferId}),t=this.length-1;t>=0;t--){for(i=this.at(t),r=0;r<n.length;r++)if(e[r]==i.get("BetOfferId"))break;r==n.length&&this.remove(i)}this.add(f)},comparator:function(n,t){var i,r,u,f;if(n.get("Order")<t.get("Order"))return-1;if(n.get("Order")>t.get("Order"))return 1;if(i=n.get("SpecialBetValue"),r=t.get("SpecialBetValue"),i!=null&&r!=null&&n.get("BetTypeId")==t.get("BetTypeId")){if(jQuery.isNumeric(i)&&jQuery.isNumeric(r)&&(u=parseFloat(i),f=parseFloat(r),!isNaN(u)&&!isNaN(f))){if(u<f)return-1;if(u>f)return 1}if(i<r)return-1;if(i>r)return 1}return n.get("BetTypeId")<t.get("BetTypeId")?-1:n.get("BetTypeId")>t.get("BetTypeId")?1:0}})}();PSK.Collections=PSK.Collections||{},function(){"use strict";PSK.Collections.Sport=Backbone.Collection.extend({model:PSK.Models.Sport,url:"mock/sports.json",hasUnselectedEvents:function(n){return!this.every(function(t){return!t.events.hasUnselectedEvents(n)})}})}();PSK.Collections=PSK.Collections||{},function(){"use strict";PSK.Collections.Contest=Backbone.Collection.extend({model:PSK.Models.Contest,comparator:function(n,t){return n.get("ContestOrder")<t.get("ContestOrder")?-1:n.get("ContestOrder")>t.get("ContestOrder")?1:n.get("ContestName")<t.get("ContestName")?-1:n.get("ContestName")>t.get("ContestName")?1:0}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.BetLayout=Backbone.View.extend({el:"#psk-main-layout",template:JST["LiveBetting/gui/templates/bet-layout.hbs"],tagName:"div",id:"",className:"",events:{},isIE:!1,initialize:function(){this.isIE=PSK.Utils.checkIE11()},render:function(){return this.$el.html(this.template()),this.isIE&&this.$el.find(".multi-view").addClass("IE11-WIN7"),this}})}();PSK.Views=PSK.Views||{},function(){"use strict";var t=$(window),n;PSK.Views.TicketPositioner=function(){this.initialize.apply(this,arguments);n=$("body")};_.extend(PSK.Views.TicketPositioner.prototype,{Position:{ABSOLUTE:0,STICKY_TOP:1,STICKY_BOTTOM:2},DefaultTicketContainerSelector:".ticket-main-layout",DefaultFooterContentSelector:"#footer-content",initialize:function(n){n=n||{};this.elSelector=n.ticketContainerSelector||this.DefaultTicketContainerSelector;this.footerSelector=n.footerContentSelector||this.DefaultFooterContentSelector;this.$el=$(this.elSelector);this.el=this.$el[0];PSK.ticketPositioner=this},cleanup:function(){},onScroll:function(){this.initialOffset=this.initialOffset||this.$el.offset();this.footerHeight=this.footerHeight||$(this.footerSelector).height();var t=window.scrollY||window.pageYOffset||window.document.documentElement.scrollTop,i=Math.max(-(n.height()-window.innerHeight-t-this.footerHeight),0),u=t+window.innerHeight>=this.$el.offset().top+this.$el.height(),r=window.innerHeight<this.$el.height()+i;t<=this.initialOffset.top?this.position!==this.Position.ABSOLUTE&&(this.position=this.Position.ABSOLUTE,this.$el.css({position:"static",top:"auto",bottom:"auto"})):u&&r||r&&i>0?(this.position=this.Position.STICKY_BOTTOM,this.$el.css({position:"fixed",bottom:i+50+"px",top:"auto"})):this.position!==this.Position.STICKY_TOP&&(this.position=this.Position.STICKY_TOP,this.$el.css({position:"fixed",top:0,bottom:"auto"}))}})}();PSK.Views=PSK.Views||{};PSK.Utils=PSK.Utils||{},function(){"use strict";PSK.Views.EventInfoBase=Backbone.View.extend({events:{"click .event-header-favourite":"onFavoriteClick","click .event-header-stream":"onVideoStartClick","click .event-header-statistic":"onStatisticClick"},renderVideos:function(){this.model.hasVideoStream()?this.$(".event-header-stream").addClass("active"):this.$(".event-header-stream").removeClass("active");this.model.Video2?this.$(".event-header-video2").show():this.$(".event-header-video2").hide()},renderFavorite:function(){this.$(".event-header-favourite")[this.model.get("Favorite")?"addClass":"removeClass"]("active")},onFavoriteClick:function(){this.model.set("Favorite",!this.model.get("Favorite"))},onVideoStartClick:function(){PSKweb.VideoStreamController.playVideo(this.model)},onStatisticClick:function(){PSK.Bus.statistic.trigger("open",this.model.get("Id"))}})}();PSK.Views=PSK.Views||{};PSK.Utils=PSK.Utils||{},function(){"use strict";PSK.Views.EventInfoNogomet=PSK.Views.EventInfoBase.extend({initialize:function(n){this.listenTo(this.model,"change:MatchTimeFormatted",this._onMatchTimeChange,this);this.listenTo(this.model,"change:Team1Score change:Team2Score",this._onScoreChange,this);this.listenTo(this.model,"change:Cards",this._onCardsChange,this);this.favoriteCollection=n.favoriteCollection},render:function(){return this.$(".event-header-cards span").tooltip("destroy"),this.$el.html(JST["LiveBetting/gui/templates/event/info/"+this.model.getSportLabelKey()+".hbs"](this.model.toJSON())),this.$(".team1-name").text().length!=this.model.get("Team1Name").length&&(this.$(".team1-name").attr("title",this.model.get("Team1Name")),this.$(".team1-name").tooltip()),this.$(".team2-name").text().length!=this.model.get("Team2Name").length&&(this.$(".team2-name").attr("title",this.model.get("Team2Name")),this.$(".team2-name").tooltip()),this._onMatchTimeChange(),this.renderVideos(),this.renderFavorite(),PSK.Utils.renderCards(this.model,this.$(".event-header-cards.top"),this.$(".event-header-cards.bottom")),this},_onMatchTimeChange:function(){this.$(".event-info-minutes").text(this.model.get("MatchTimeFormatted"))},_onScoreChange:function(n){this.$(".event-header-result.top").text(n.get("Team1Score"));this.$(".event-header-result.bottom").text(n.get("Team2Score"))},_onCardsChange:function(){this.$(".event-header-cards span").tooltip("destroy");PSK.Utils.renderCards(this.model,this.$(".event-header-cards.top"),this.$(".event-header-cards.bottom"))}})}();PSK.Views=PSK.Views||{};PSK.Utils=PSK.Utils||{},function(){"use strict";PSK.Views.EventInfoTenis=PSK.Views.EventInfoBase.extend({initialize:function(n){this.template=JST["LiveBetting/gui/templates/event/info/"+this.model.getSportLabelKey()+".hbs"];this.listenTo(this.model,"change:Team1SetScores change:Team2SetScores",this._onTeamSetScore);this.listenTo(this.model,"change:Team1GameScore change:Team2GameScore",this._onGameSetScore);this.listenTo(this.model,"change:Server",this._setCurrentServer);this.favoriteCollection=n.favoriteCollection},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderPlayers(),this.renderVideos(),this.renderFavorite(),this},_onTeamSetScore:function(n){this.$(".set-score-team1").html(_.reduce(n.get("Team1SetScores"),function(n,t){return n+'<span class="event-header-set-score set-score-cell">'+t+"<\/span>"},""));this.$(".set-score-team2").html(_.reduce(n.get("Team2SetScores"),function(n,t){return n+'<span class="event-header-set-score set-score-cell">'+t+"<\/span>"},""))},_onGameSetScore:function(n){this.$(".game-score-team1").text(n.get("Team1GameScore"));this.$(".game-score-team2").text(n.get("Team2GameScore"))},_scoreChangeFormater:function(n){var t="",i="",r;return n&&(r=n.split("-"),$(r).each(function(n,r){var u=r.split(":"),f=PSK.Utils.trimSpaces(u[0]),e=PSK.Utils.trimSpaces(u[1]);t+=f+" ";i+=e+" "}),t=PSK.Utils.trimSpaces(t),i=PSK.Utils.trimSpaces(i)),[t,i]},_setCurrentServer:function(){this.$(".player1-name, .player2-name").removeClass("player-with-serve");this.model.get("Server")=="1"?this.$(".player1-name").addClass("player-with-serve"):this.model.get("Server")=="2"&&this.$(".player2-name").addClass("player-with-serve")},_renderPlayers:function(){this.model.get("Team1Name").length>20&&(this.$(".player1-name").attr("title",this.model.get("Team1Name")),this.$(".player1-name").tooltip());this.model.get("Team2Name").length>20&&(this.$(".player2-name").attr("title",this.model.get("Team2Name")),this.$(".player2-name").tooltip());this.model.get("Server")=="1"?this.$(".player1-name").addClass("player-with-serve"):this.model.get("Server")=="2"&&this.$(".player2-name").addClass("player-with-serve")}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.EventInfoHokej=PSK.Views.EventInfoTenis.extend({initialize:function(){PSK.Views.EventInfoHokej.__super__.initialize.apply(this,arguments);this.listenTo(this.model,"change:MatchTimeFormatted",this._onMatchTimeChange,this);this.listenTo(this.model,"change:Team1Score change:Team2Score",this._onScoreChange,this)},_onMatchTimeChange:function(){this.$(".event-info-minutes").text(this.model.get("MatchTimeFormatted"))},_onScoreChange:function(n){this.$(".game-score-team1").text(n.get("Team1Score"));this.$(".game-score-team2").text(n.get("Team2Score"))}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.EventInfoOdbojka=PSK.Views.EventInfoTenis.extend({initialize:function(){PSK.Views.EventInfoOdbojka.__super__.initialize.apply(this,arguments);this.listenTo(this.model,"change:Team1Score change:Team2Score",this._onScoreChange,this)},_onScoreChange:function(n){this.$(".game-score-team1").text(n.get("Team1Score"));this.$(".game-score-team2").text(n.get("Team2Score"))}})}();PSK.Views=PSK.Views||{};PSK.Utils=PSK.Utils||{},function(){"use strict";PSK.Views.EventInfoBaseball=PSK.Views.EventInfoBase.extend({initialize:function(n){this.template=JST["LiveBetting/gui/templates/event/info/"+this.model.getSportLabelKey()+".hbs"];this.listenTo(this.model,"change:Team1SetScores change:Team2SetScores",this._onTeamSetScore);this.listenTo(this.model,"change:Status",this._setCurrentServer);this.favoriteCollection=n.favoriteCollection},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderPlayers(),this.renderVideos(),this.renderFavorite(),this},_onTeamSetScore:function(n){var t=n.get("Team1SetScores"),i=n.get("Team2SetScores");this.$(".set-score-team1").html(this.scoreHtml(t));this.$(".set-score-team2").html(this.scoreHtml(t));this.$("event-header-game.game-score-team1").text(this.sumScore(t));this.$("event-header-game.game-score-team2").text(this.sumScore(i))},scoreHtml:function(n){return _.reduce(n,function(n,t){return n+'<span class="event-header-set-score set-score-cell">'+t+"<\/span>"},"")},sumScore:function(n){return n.length===0?"-":_.reduce(n,function(n,t){return n+ +t},0)},_setCurrentServer:function(){this.$(".player1-name, .player2-name").removeClass("player-with-serve");var n=this.model.get("Status").substr(-2);n==="IT"?this.$(".player2-name").addClass("player-with-serve"):n==="IB"&&this.$(".player1-name").addClass("player-with-serve");this.$(".event-info-minutes").text(this.model.get("StatusFormatted"))},_renderPlayers:function(){this.model.get("Team1Name").length>20&&(this.$(".player1-name").attr("title",this.model.get("Team1Name")),this.$(".player1-name").tooltip());this.model.get("Team2Name").length>20&&(this.$(".player2-name").attr("title",this.model.get("Team2Name")),this.$(".player2-name").tooltip());this._setCurrentServer()}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.EventBetOffer=Backbone.View.extend({template:JST["LiveBetting/gui/templates/event/bet-offer.hbs"],className:"bet-offer",events:{"click .bet-pick[data-pick]":"onBetPickClick"},initialize:function(n){this.betEvent=n.betEvent;this.specialBetVisible=!!n.specialBetVisible;this.classRemovalTimers={};this.listenTo(this.model,"change:SpecialBetValue",this.updateSpecialBetValue,this);this.listenTo(this.model,"change:Picks",this.checkChangedAttributes,this);this.listenTo(this.model,"change:SelectedBetPick",this.onSelectedBetPickChange);this.$el.addClass("bet-offer-"+this.model.get("BetOfferId"))},serializeData:function(){var n=this.model.toJSON(),t;for(n.SpecialBetValueVisible=this._specialBetVisible(),n.Picks.sort(function(n,t){return n.Order-t.Order}),n.PickCount=n.Picks.length+(n.SpecialBetValueVisible?1:0),n.SportName=this.betEvent.getSportLabelKey(),t=0;t<n.Picks.length;t++)n.Picks[t].Index=t,n.Picks[t].PickCount=n.PickCount;return n},render:function(){return this.$el.html(this.template(this.serializeData())),this.$betPicks=this.$(".bet-pick:not(.bet-pick-special)"),this.$specialBetPick=this.$(".bet-pick-special"),this.onSelectedBetPickChange(),this},updateSpecialBetValue:function(){this._specialBetVisible()&&this.$specialBetPick.text(this.model.get("SpecialBetValue"))},_specialBetVisible:function(){return this.model.get("SpecialBetValue")&&this.specialBetVisible},checkChangedAttributes:function(n){for(var t,i,r=n._previousAttributes.Picks.length-1;r>=0;r--)i=n._previousAttributes.Picks[r],t=_.findWhere(n.changed.Picks,{BetTypePick:i.BetTypePick}),t&&i.Odds!==t.Odds&&this._showUpperDowners(n,i,t)},_showUpperDowners:function(n,t,i){var f=this,r=n.changed.Picks.indexOf(i),u=$(this.$betPicks[r]),e=t.Odds||0,o=i.Odds||0;u.removeClass("upper downer").addClass(e<o?"upper":"downer");this.classRemovalTimers[r]&&(window.clearTimeout(this.classRemovalTimers[r]),delete this.classRemovalTimers[r]);this.classRemovalTimers[r]=window.setTimeout(function(){u.removeClass("upper downer");delete f.classRemovalTimers[r]},5e3);this._updateOddsValueChange(u,i.Odds)},_updateOddsValueChange:function(n,t){n.html(PSKweb.formatBetPickOdds(t))},onBetPickClick:function(n){var t=$(n.target).closest(".bet-pick");t.hasClass("bet-pick-special-offer")||this.betEvent.get("IsReallyActive")&&PSKweb.Betslip.Controller.toggleBet(this.model.get("BetOfferId"),t.data("pick"),t[0])},onSelectedBetPickChange:function(){var n=this.model.get("SelectedBetPick");this.$betPicks.removeClass("selected");this.$betPicks.filter("[data-pick='"+n+"']").addClass("selected")}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.Contest=Backbone.View.extend({template:JST["LiveBetting/gui/templates/event/contest.hbs"],tagName:"div",className:"psk-contest",events:{"click .contest-header":"onExpandClick"},initialize:function(n){this.expanded=!0;this.hidden=!1;this.$el.addClass("expanded");this.$el.attr("data-contest-id",this.model.get("ContestId"));this.eventListView=new PSK.Views.EventList({collection:this.model.events,itemViewData:{betTypes:n.data.betTypes}});this.listenTo(this.model,"change:NumOfEventsWithVideos",this.updateVideoFilter,this);this.listenTo(this.eventListView,"hiddenChanged:item",this.onHiddenChanged,this)},onHiddenChanged:function(){var n=this.$el.hasClass("hidden");this.$el[this.model.events.models.some(function(n){return n.isValidEvent()})?"removeClass":"addClass"]("hidden");n!=this.$el.hasClass("hidden")&&this.trigger("hiddenChanged")},render:function(){return this.$el.html(this.template(this.serializeData())),this.$eventListContainer=this.$(".contest-event-list-container"),this.$eventListContainer.html(this.eventListView.render().el),this},updateVideoFilter:function(){this.videoFiltering&&this.model.get("NumOfEventsWithVideos")===0&&!this.hidden?(this.$el.hide(),this.hidden=!0):this.hidden&&(this.$el.show(),this.hidden=!1)},toggleVideoStreamFilter:function(n){this.videoFiltering!==n&&(this.videoFiltering=!!n,this.updateVideoFilter())},serializeData:function(){return this.model.toJSON()},onExpandClick:function(){this.expanded?(this.$eventListContainer.slideUp(),this.$el.removeClass("expanded")):(this.$eventListContainer.slideDown(),this.$el.addClass("expanded"));this.expanded=!this.expanded}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.ContestList=PSK.Views.AbstractList.extend({singleItem:PSK.Views.Contest,className:"psk-contest-list",toggleVideoStreamFilter:function(n){this.videoFiltering!==n&&(this.videoFiltering=n,_.each(this.items,function(t){t.toggleVideoStreamFilter(n)}))}})}();PSK.Views=PSK.Views||{},function(){"use strict";var n={"american-football":PSK.Views.EventInfoTenis,baseball:PSK.Views.EventInfoBaseball,basketball:PSK.Views.EventInfoNogomet,"beach-volleyball":PSK.Views.EventInfoOdbojka,darts:PSK.Views.EventInfoTenis,futsal:PSK.Views.EventInfoNogomet,handball:PSK.Views.EventInfoNogomet,"ice-hockey":PSK.Views.EventInfoHokej,snooker:PSK.Views.EventInfoTenis,soccer:PSK.Views.EventInfoNogomet,tennis:PSK.Views.EventInfoTenis,volleyball:PSK.Views.EventInfoOdbojka};PSK.Views.Event=Backbone.View.extend({template:JST["LiveBetting/gui/templates/event/event.hbs"],tagName:"div",className:"psk-event",events:{"click .bet-pick":"onBetClick","click .event-col-other-bets":"onOtherBetsClick","click .team-names":"onOtherBetsClick"},initialize:function(n){this.eventBetOffers=[];this.betOffersRendered=!1;this.listenTo(this.model,"change",this.onModelChange);this.sportBetTypes=n.data.betTypes},render:function(){var n=this.serializeData();return this.$el.html(this.template(n)),this._updateHeader(),this._renderBetOffers(n.BetOffers),this.$el.attr("data-event-id",this.model.get("Id")),this._updateHiddenStatus(),this},onModelChange:function(){var i=_.keys(this.model.changed),n,t;_.isEqual(jQuery.map(this.model.get("BetOffers"),function(n){return n.BetOfferId}),jQuery.map(this.model.previous("BetOffers"),function(n){return n.BetOfferId}))||(t=this.serializeData(),this._renderBetOffers(t.BetOffers),n=this.$(".event-col-other-bets"),n.length>0&&n.text(t.OtherBetsLabel),$(window).trigger("bet:offer:size-change"));(i.length>0&&!(i.length===1&&this.model.hasChanged("BetOffers"))||this.model.hasChanged("VideoStreamId"))&&this._updateHeader();(this.model.hasChanged("IsReallyActive")||this.model.hasChanged("BetOffers")||this.model.hasChanged("Status")||this.model.hasChanged("LiveDisabled"))&&this._updateHiddenStatus()},_updateHeader:function(){$("div.tooltip:not(:last-child)").remove();this.headerView?this.headerView.renderVideos():(this.headerView=new n[this.model.getSportLabelKey()]({model:this.model}),this.$(".event-col-header").html(this.headerView.render().el));this.$el[this.model.get("Favorite")?"addClass":"removeClass"]("favorite");this.$el[this.model.get("IsReallyActive")?"removeClass":"addClass"]("disabled")},_updateHiddenStatus:function(){this.$el[this.model.isValidEvent()?"removeClass":"addClass"]("hidden");this.trigger("hiddenChanged")},serializeData:function(){var n=this.model.toJSON(),t;return n.BetOffers=this._getBetOffersForRender(),t=0,_.each(n.BetOffers,function(n){t=t+(n!==undefined?1:0)}),n.OtherBetsCount=this.model.get("BetOffers").length,n.OtherBetsLabel=n.OtherBetsCount>0?"+"+n.OtherBetsCount:">",n},_getBetOffersForRender:function(){var n=[],t=_.pluck(this.sportBetTypes,"BetTypeId");return _.each(t,function(t){n.push(this._getMostBalancedOfferForBetTypeId(t))},this),n},_getMostBalancedOfferForBetTypeId:function(n){var t=this.model.betOffers.findWhere({BetTypeId:n,MostBalanced:!0});return t||(t=this.model.betOffers.findWhere({BetTypeId:n})),t},_renderBetOffers:function(n){n=n||this.serializeData().BetOffers;var r,u,i,f,t,e;if(this.betOffersRendered=!0,this._cleanupBetOffers(),u=document.createDocumentFragment(),this.model.hasBetOffersEmpty()&&this.model.get("IsReallyActive")&&(f=this.model.getBetOffersEmptyReason(),f.isValid)){this.$(".bet-offer-list").append('<div class="bet-empty listview">'+f.translation+"<\/div>");return}for(e=function(){this._renderBetOffers()},t=0;t<n.length;t++)n[t]?(r=new PSK.Views.EventBetOffer({model:n[t],betEvent:this.model,specialBetVisible:!!(_.findWhere(this.sportBetTypes,{BetTypeId:n[t].get("BetTypeId")})||{}).SpecialBetValue}),this.listenTo(r,"change:MostBalanced",e,this),i=r.render().el,this.eventBetOffers.push(r)):(i=document.createElement("div"),i.innerHTML="&nbsp;",i.className="bet-offer"),u.appendChild(i);this.$(".bet-offer-list").append(u)},onOtherBetsClick:function(){PSK.Bus.liveEvent.trigger("details",this.model)},cleanup:function(){this.headerView.remove();this._cleanupBetOffers()},_cleanupBetOffers:function(){_.each(this.eventBetOffers,function(n){n.remove();this.stopListening(n)},this);this.$(".bet-offer-list").empty();this.eventBetOffers.length=0}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.EventList=PSK.Views.AbstractList.extend({singleItem:PSK.Views.Event,className:"psk-event-list"})}();PSK.Views=PSK.Views||{},function(){"use strict";var t=$(window),n={TOP:0,STICKY:1,BOTTOM:2};PSK.Views.SportGroup=Backbone.View.extend({template:JST["LiveBetting/gui/templates/event/sport-group.hbs"],headerTemplate:JST["LiveBetting/gui/templates/event/sport-group-header.hbs"],tagName:"div",className:"psk-sport-group",hiddenClass:"hidden",events:{"click .sport-group-header":"onExpandClick"},initialize:function(){this.expanded=!0;this.videoFiltering=!1;this.headerHeight=45;this.$el.addClass("sport-group-type-"+this.model.getSportLabelKey()+" expanded");this.betOfferMaxColCount=this.model.get("BetTypes").length;this.contestListView=new PSK.Views.ContestList({collection:this.model.contests,itemViewData:{betTypes:this.model.get("BetTypes")}});this.listenTo(PSK.Bus.liveEvent,"event-details-dialog:open",this.disableStickyHeader,this);this.listenTo(PSK.Bus.liveEvent,"event-details-dialog:close",this.enableStickyHeader,this);this.listenTo(this.model.events,"add remove reset",this.onEventsCollectionChange,this);this.listenTo(this.contestListView,"hiddenChanged:item",this.onHiddenChanged,this);this.onWindowScroll=_.bind(this.onWindowScroll,this);this.listenTo(PSK.Bus.window,"scroll resize",this.onWindowScroll,this);this.initStickyHeader()},render:function(){this.$el.html(this.template());this.$header=this.$(".sport-group-header");this.$expandButton=this.$(".header-col-expand-button");this.$sportGroupListContainer=this.$(".sport-group-list-container");this.$sportGroupListContainer.html(this.contestListView.render().el);this.onEventsCollectionChange();var n=this;return setTimeout(function(){n.setTop()},50),this.onHiddenChanged(),$(window).trigger("bet:offer:size-change"),this},toggleVideoStreamFilter:function(n){this.videoFiltering!==n&&(this.videoFiltering=n,this.contestListView.toggleVideoStreamFilter(n))},updateVideoFilter:function(){this.videoFiltering&&this.model.get("NumOfContestsWithVideos")===0&&!this.hidden?(this.$el.hide(),this.hidden=!0):this.hidden&&(this.$el.show(),this.hidden=!1)},serializeHeaderData:function(){return _.defaults(this.model.toJSON(),{EventCount:this.videoFiltering?this.model.get("NumOfContestsWithVideos"):this.model.events.filter(function(n){return n.isValidEvent()}).length})},renderHeader:function(){this.$(".sport-group-header").html(this.headerTemplate(this.serializeHeaderData()));this.$(".sport-group-header").addClass("bg-pattern-"+this.model.getSportLabelKey());this.$expandButton=this.$(".header-col-expand-button");$(window).trigger("bet:offer:size-change")},onEventsCollectionChange:function(){this.renderHeader();this.model.events.length===0?(this.$el.addClass(this.hiddenClass),this.disableStickyHeader()):(this.$el.removeClass(this.hiddenClass),this.enableStickyHeader())},onHiddenChanged:function(){this.$el[this.$el.find(".psk-contest:not(.hidden)").length>0?"removeClass":"addClass"](this.hiddenClass);this.renderHeader()},onExpandClick:function(){this.expanded?(this.$sportGroupListContainer.slideUp(),this.$el.removeClass("expanded"),this.disableStickyHeader()):(this.$sportGroupListContainer.slideDown(),this.$el.addClass("expanded"),this.enableStickyHeader());this.expanded=!this.expanded},initStickyHeader:function(){PSK.LIVE&&t.scroll(this.onWindowScroll)},onWindowScroll:function(){var i=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,t;if(!this._stickyHeaderDisabled){this.headerHeight=this.$header.height();this.$header=this.$header||this.$(".sport-group-header");try{t=this.$el[0].getBoundingClientRect()}catch(r){return}if(!(t.bottom<=0)||t.height!==0&&t.width!==0){if(t.bottom<0){this.setBottom();return}this.position===n.TOP?t.top<=0&&this.setSticky():this.position===n.STICKY||this.position===n.BOTTOM&&i==0?t.top>0?this.setTop():t.bottom<-5?this.setBottom():t.bottom<this.headerHeight?(this._updatingTop=!0,this.$header.css("top",t.bottom-this.headerHeight)):this._updatingTop&&(this.$header.css("top",0),this._updatingTop=!1):t.bottom>=0&&(this.position=n.STICKY,this.$header.css("display","block"));this.$header.hasClass("sticky")?this.$header.width(this.$el.width()):this.$header.css("width","auto")}}},disableStickyHeader:function(){this.setTop();this._stickyHeaderDisabled=!0},enableStickyHeader:function(){this._stickyHeaderDisabled=!1;this.onWindowScroll()},setSticky:function(){this.position=n.STICKY;this.$header=this.$header||this.$(".sport-group-header");this.$header.css({position:"fixed",display:"block",top:"0","z-index":"1"});this.$expandButton.css({display:"none"});this.$header.addClass("sticky");this.$el.css("padding-top",this.headerHeight+"px");this.$header.width(this.$el.width())},setTop:function(){this.position=n.TOP;this.$header=this.$header||this.$(".sport-group-header");this.$header.css({position:"static",display:"block",top:"auto","z-index":"auto","min-width":"auto"});this.$expandButton.css({display:""});this.$header.removeClass("sticky");this.$el.css("padding-top","0px")},setBottom:function(){this.position=n.BOTTOM;this.$header=this.$header||this.$(".sport-group-header");this.$header.css({display:"none"})}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.SportGroupList=Backbone.View.extend({template:JST["LiveBetting/gui/templates/event/sport-group-list.hbs"],tagName:"div",className:"psk-sport-group-list",initialize:function(n){this.sports=n.sports;this.items=[];this.listenTo(this.sports,"reset",this.render,this)},toggleVideoStreamFilter:function(n){this.videoFiltering!==n&&(this.videoFiltering=n,_.each(this.items,function(t){t.toggleVideoStreamFilter(n)}))},render:function(){this.$el.html(this.template());var n=this.$(".psk-sport-group-items");return this.sports.each(function(t){var i=new PSK.Views.SportGroup({model:t});this.items.push(i);n.append(i.render().el)},this),this}})}();PSK.Views=PSK.Views||{},function(){"use strict";PSK.Views.LiveMain=Backbone.View.extend({template:JST["LiveBetting/gui/templates/live/main.hbs"],className:"main live-main",events:{"click .event-details-dialog-container":"onDialogContainerClick"},spinnerOptions:{lines:11,length:7,width:5,radius:10,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"200px",left:"50%"},EventDialogContainerMinPadding:0,initialize:function(n){this.bets=n.bets;this.favoriteBets=n.favoriteBets;this.unselectedBets=n.unselectedBets;this.videoStreamFilter=!1;this.spinner=new Spinner(this.spinnerOptions);this.sportsGroupList=new PSK.Views.SportGroupList({sports:n.unselectedSports});this.favoritesSportsGroupList=new PSK.Views.SportGroupList({sports:n.favoritesSports});this.listenTo(this.bets,"add remove change",this.updateNoEventsMessage,this);this.listenTo(this.favoriteBets,"add remove change",this.updateFavoriteEventsVisibility,this);this.listenTo(this.unselectedBets,"add remove change",this.updateUnselectedEventsVisibility,this);this.listenTo(PSK.Bus.liveEvent,"details",this.showEventItemDetails,this);this.listenTo(PSK.Bus.liveEvent,"detailsFilter",this.detailsFilterToggled,this);this.listenTo(Backbone,"video:filter",this.toggleVideoStreamFilter,this);this.listenTo(PSK.Bus.window,"scroll",this.onWindowScroll,this);this.listenToOnce(PSK.Bus.liveEvent,"liveEventsLoaded",this.updateNoEventsMessage,this)},render:function(){return this.$el.html(this.template()),this.$(".other-tables .psk-events").html(this.sportsGroupList.render().el),this.$(".favourite-tables .psk-events").html(this.favoritesSportsGroupList.render().el),this.spinner.spin(),this.$el.append(this.spinner.el),this.$favoriteEvents=this.$(".favourite-tables"),this.$unselectedEvents=this.$(".other-tables"),this.$eventDetailsDialogContainer=this.$(".event-details-dialog-container"),this.$eventDetailsDialog=this.$(".event-details-dialog"),this.updateFavoriteEventsVisibility(),this.updateUnselectedEventsVisibility(),this},toggleVideoStreamFilter:function(){return this.videoStreamFilter=!this.videoStreamFilter,this.sportsGroupList.toggleVideoStreamFilter(this.videoStreamFilter),this.favoritesSportsGroupList.toggleVideoStreamFilter(this.videoStreamFilter),this.videoStreamFilter},updateFavoriteEventsVisibility:function(){this.$favoriteEvents&&(this.favoriteBets.length>0?this.$favoriteEvents.show():this.$favoriteEvents.hide())},updateUnselectedEventsVisibility:function(){this.$unselectedBets&&(this.unselectedBets.length>0?this.$unselectedEvents.show():this.$unselectedEvents.hide())},updateNoEventsMessage:function(){var r,e,f,o,n,t,u,i;if(PSK.Utils.fixContentContainerSize(),r=jQuery("#live-message"),r.html(""),r.addClass("hidden"),e=this.bets.models.filter(function(n){return n.get("IsAnnouncement")}),e.length===this.bets.length){for(f=new Date(3e3,0,1),o=new Date,n=null,i=0;i<this.bets.length;i++)(t=(this.bets.models[i].get("StartDate")+" "+this.bets.models[i].get("StartTime")).match(/[0-9]+/g),u=new Date(t[2],t[1]-1,t[0],t[3],t[4]),u<o)||u<f&&(f=u,n=this.bets.models[i]);n!=null&&(r.removeClass("hidden"),r.html('<div class="header">'+PSKweb.Translations.nextEventStartsMessage+n.get("StartTime")+'<\/div><div class="mainRow"><div class="sport-icon sport-icon-'+PSKweb.Utils.getDefaultSportName(n.get("SportId"))+'"><\/div><span class="event"> '+n.get("Name")+'<\/span><span class="contest">'+n.get("ContestName")+"<\/span><\/div>"))}this.spinner.el&&this.spinner.stop()},detailsFilterToggled:function(){},showEventItemDetails:function(n){this.eventDetailsView&&(this.eventDetailsView.remove(),this.stopListening(this.eventDetailsView));this.eventDetailsView=new PSK.Views.EventDetails({model:n});this.listenTo(this.eventDetailsView,"close",function(){PSK.Bus.liveEvent.trigger("event-details-dialog:close");this.$eventDetailsDialogContainer.addClass("hidden");this.$eventDetailsDialog.html("");this.$el.css("min-height","auto");this.detailsDialogOpened=!1;this.currentDialogPadding=0},this);this.$eventDetailsDialogContainer.removeClass("hidden");this.$eventDetailsDialog.html(this.eventDetailsView.render().el);this.listenTo(this.eventDetailsView,"multiview:add",function(n){this.trigger("multiview:add",n)},this);this.$el.css("min-height",Math.max(jQuery(".content-container").height(),this.eventDetailsView.$el.height())+"px");this.detailsDialogOpened=!0;PSK.Bus.liveEvent.trigger("event-details-dialog:open");var t=this;setTimeout(function(){t.onWindowScroll();t.eventDetailsView.updateHeaderPosition()},10)},onDialogContainerClick:function(n){n.currentTarget===n.target&&this.eventDetailsView&&this.eventDetailsView.trigger("close")},onWindowScroll:function(){if(this.detailsDialogOpened&&this.eventDetailsView){var t=this.$eventDetailsDialogContainer[0].getBoundingClientRect(),n=-t.top;n>0?n+this.$eventDetailsDialog.height()<this.$eventDetailsDialogContainer.height()?this.$eventDetailsDialog.css("top",n):this.$eventDetailsDialog.css("top",this.$eventDetailsDialogContainer.height()-this.$eventDetailsDialog.height()):this.$eventDetailsDialog.css("top",0)}}})}();PSK.Bus=PSK.Bus||{},function(){"use strict";PSK.Bus.Base=function(){this.initialize.apply(this,arguments)};_.extend(PSK.Bus.Base.prototype,Backbone.Events,{initialize:function(){}})}();PSK.Bus=PSK.Bus||{},function(){"use strict";PSK.Bus.liveEvent=new PSK.Bus.Base}();PSK.Bus=PSK.Bus||{};PSKweb=PSKweb||{};PSKweb.Loading=PSKweb.Loading||{},function(){"use strict";PSK.Bus.statistic=new PSK.Bus.Base;PSK.Bus.statistic.init=function(){this.enabled=!1;var n=$("#psk-main-layout, #live-offer-box");PSK.IsBetradarStatisticEnabled?(this.setStatisticUrl(PSK.BetRadarStatisticsMatchPageUrl),this.enabled=!0,n.removeClass("no-statistic")):n.addClass("no-statistic")};PSK.Bus.statistic.setStatisticUrl=function(n){this.pageUrl=n||"http://www.stats.betradar.com/statistics/psk/?clientid=301&matchid={0}&treemenu=false"};PSK.Bus.statistic.on("open",function(n){if(this.enabled){n=parseInt(n,10);n=Math.abs(n);var t=this.pageUrl.replace("clientmatchid","matchid").replace("{0}",n);window.open(t,"Statistika","width=850,height=750,resizable=yes,scrollbars=yes")}})}();PSKweb.Loading.liveVideoToggle=function(){"use strict";$("#video-toggle").click(function(){Backbone.trigger("video:filter");$(this).hasClass("inactive")?($(this).removeClass("inactive"),$(this).addClass("active")):($(this).removeClass("active"),$(this).addClass("inactive"))})};PSK.Bus=PSK.Bus||{},function(){"use strict";PSK.Bus.ticket=new PSK.Bus.Base;setTimeout(function(){PSK.Bus.ticket.on("betslip:modified",function(){PSK.Utils.fixContentContainerSize()})},500)}();PSK.Bus=PSK.Bus||{},function(){"use strict";PSK.Bus.window=new PSK.Bus.Base;$(window).on("scroll",function(){PSK.Bus.window.trigger("scroll")});$(window).on("resize",function(){PSK.Bus.window.trigger("resize")});$(window).on("keyup",function(n){PSK.Bus.window.trigger("keyup",n)});$(window).on("keydown",function(n){PSK.Bus.window.trigger("keydown",n)})}()